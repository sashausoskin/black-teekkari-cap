/* @license GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function(Drupal){var wrapperHandleMainMenuOutsideClick=null;var getMobileMediaQuery=function getMobileMediaQuery(){var fallBackForIE='900px';var breakpoint=getComputedStyle(document.documentElement).getPropertyValue('--js-header-mq-mobile')||fallBackForIE;var breakpointMaxWidth=parseInt(breakpoint,10)-1+'px';var mq='(max-width: '+breakpointMaxWidth+')';return mq;};var MOBILE_MEDIA_QUERY=getMobileMediaQuery();function removeOutsideClickListener(){document.querySelector('body').removeEventListener('click',wrapperHandleMainMenuOutsideClick,true);}function closeMainMenu(button){var menuElements=document.getElementsByClassName('aalto-main-menu__item');var i;for(i=0;i<menuElements.length;i++)if(menuElements[i]!==button)menuElements[i].classList.remove('not-selected');button.setAttribute('aria-expanded',false);if(document.getElementById('black-overlay'))document.getElementById('black-overlay').classList.remove('visible');removeOutsideClickListener();}function handleMainMenuOutsideClick(e,button){if((Drupal.behaviors.aalto_utils.isMediaQueryMatch(MOBILE_MEDIA_QUERY)===false&&!e.target.closest('.aalto-main-menu__submenu'))||(!e.target.closest('.aalto-main-menu__submenu')&&Drupal.behaviors.aalto_utils.isMediaQueryMatch(MOBILE_MEDIA_QUERY)===true&&!e.target.closest('#aalto-menu')))if(e.target!==button)closeMainMenu(button);}function toggleMenu(button,expanded){var body=document.querySelector('body');button.setAttribute('aria-expanded',!expanded);if(expanded===false)body.classList.add('mobile-menu-open');else body.classList.remove('mobile-menu-open');}function openSubMenuWithSelectedItem(){var menuItems=document.getElementsByClassName('aalto-main-menu__item');var subMenuItems=document.querySelectorAll('.aalto-menu__submenu-link:not(.top-ribbon__submenu-link)');var i;var u;var selectedItemsParentButton;for(i=0;i<subMenuItems.length;i++)if(subMenuItems[i].classList.contains('selected')){for(u=0;u<menuItems.length;u++){menuItems[u].classList.add('not-selected');menuItems[u].setAttribute('aria-expanded',false);}selectedItemsParentButton=subMenuItems[i].parentElement.parentElement.previousElementSibling;selectedItemsParentButton.setAttribute('aria-expanded',true);selectedItemsParentButton.classList.remove('not-selected');if(document.getElementById('black-overlay'))document.getElementById('black-overlay').classList.add('visible');wrapperHandleMainMenuOutsideClick=function(event){handleMainMenuOutsideClick(event,selectedItemsParentButton);};document.querySelector('body').addEventListener('click',wrapperHandleMainMenuOutsideClick,true);}}function closeMainMenusSubMenus(){var menuItems=document.getElementsByClassName('aalto-main-menu__item');var i;for(i=0;i<menuItems.length;i++){menuItems[i].classList.remove('not-selected');menuItems[i].setAttribute('aria-expanded',false);if(document.getElementById('black-overlay'))document.getElementById('black-overlay').classList.remove('visible');}}function handleMainMenuKeyPress(e,button){var expanded=Drupal.behaviors.aalto_utils.isExpanded(button);if(expanded===true&&Drupal.behaviors.aalto_utils.isEscPressed(e)===true){e.preventDefault();e.stopPropagation();closeMainMenu(button);button.focus();}if(e.key==='Tab'&&expanded===true)Drupal.behaviors.aalto_utils.loopWithTab(e);}function handleSubmenuWidth(){var body=document.getElementsByTagName('body');var scrollbarWidth=body[0].scrollWidth-body[0].clientWidth;var subMenu=document.getElementsByClassName('aalto-main-menu__submenu');var subMenuWrapper=document.getElementsByClassName('aalto-main-menu__submenu-wrapper');var i;setTimeout(function waitToCheckScrollbar(){scrollbarWidth=body[0].scrollWidth-body[0].clientWidth;if(body[0].clientWidth>1540&&scrollbarWidth!==0){for(i=0;i<subMenu.length;i++)subMenu[i].style.marginRight=scrollbarWidth+'px';for(i=0;i<subMenuWrapper.length;i++){subMenuWrapper[i].style.position='relative';subMenuWrapper[i].style.right=-scrollbarWidth+'px';}}},10);}handleSubmenuWidth();function handleMainMenuButtonClick(e){var button=e.target;var expanded=Drupal.behaviors.aalto_utils.isExpanded(button);var menuElements=document.getElementsByClassName('aalto-main-menu__item');var menuEntity=document.getElementsByClassName('aalto-main-menu__navigation-item');var i;if(expanded===true){closeMainMenu(button);if(Drupal.behaviors.aalto_utils.isMediaQueryMatch(MOBILE_MEDIA_QUERY)===true)removeOutsideClickListener();button.focus();}else{Drupal.behaviors.aalto_utils.toggleMenu(button,expanded);if(button.classList.contains('aalto-menu__action-toggle--slide-into-view')&&document.getElementById('black-overlay'))document.getElementById('black-overlay').classList.add('visible');for(i=0;i<menuElements.length;i++)if(menuElements[i]!==button)menuElements[i].classList.add('not-selected');for(i=0;i<menuEntity.length;i++)Drupal.behaviors.aalto_utils.setupMenuKeys(menuEntity[i],function(){return handleMainMenuKeyPress(event,button);});wrapperHandleMainMenuOutsideClick=function(event){handleMainMenuOutsideClick(event,button);};document.querySelector('body').addEventListener('click',wrapperHandleMainMenuOutsideClick,true);button.focus();}}function handleMenuButtonClick(e){var button=e.currentTarget;var expanded=Drupal.behaviors.aalto_utils.isExpanded(button);removeOutsideClickListener();closeMainMenusSubMenus();if(document.getElementById('aalto-menu').querySelector('.aalto-menu__submenu-link'))if(!expanded)openSubMenuWithSelectedItem();toggleMenu(button,expanded);}function handleMenuKeyPress(e){var button=document.getElementById('aalto-menu-button');var expanded=Drupal.behaviors.aalto_utils.isExpanded(button);if(expanded===true&&Drupal.behaviors.aalto_utils.isMediaQueryMatch(MOBILE_MEDIA_QUERY)===true)switch(e.key){case 'Escape':case 'Esc':e.preventDefault();toggleMenu(button,expanded);button.focus();break;case 'Tab':Drupal.behaviors.aalto_utils.loopWithTab(e);break;}}Drupal.behaviors.aalto_navigation={attach:function attach(){Drupal.behaviors.aalto_utils.addListenerIfExists('aalto-menu-button','click',handleMenuButtonClick);Drupal.behaviors.aalto_utils.addListenerIfExistsByClass('aalto-main-menu__button','click',handleMainMenuButtonClick);Drupal.behaviors.aalto_utils.setupMenuKeys(document.getElementById('aalto-menu'),handleMenuKeyPress);}};})(Drupal);;
